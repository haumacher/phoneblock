<!DOCTYPE html>
<html>
<head th:replace="~{fragments/page :: head(title=#{page.setup.title})}"></head>

<body th:dir="${currentLang.direction}">
<div th:replace="~{fragments/page :: header(location=${currentPage})}"></div>

<section class="section">
	<div class="content">
		<h1 data-tx="t0001:3dfe1d89">Installation as a telephone book</h1>

<p data-tx="t0002:10d70c8f">To install the blocklist, you need a <a th:href="@{/link/fritzbox}">"FRITZ!Box" Internet router from AVM</a> and a PhoneBlock account. It does not necessarily have to be the latest model, but you should check whether the latest FRITZ!OS is installed on it (07.29 or newer). If this is not the case, use the following installation instructions to check whether your version already offers the necessary options.</p>

<p data-tx="t0003:d62d702f">Note: Due to technical limitations of the Fritz!Box, the entire block list cannot be loaded into a phone book. Therefore, setting up a <a th:href="@{/anrufbeantworter}">PhoneBlock answering machine</a> offers better protection against SPAM calls.</p>

<p data-tx="t0052:818cc317">Use the following steps to set up the block list:</p>

<ol>
	<li><a data-tx="t0053:5cb36b90" href="#register">Register with PhoneBlock</a> <span class="tag is-success" data-tx="t0054:3378b39d" th:if="${userName}">✓ Done</span></li>
	<li><a data-tx="t0055:d44f7d1" href="#fritzbox">Log in to FRITZ!Box</a></li>
	<li><a data-tx="t0056:d6fa7b4e" href="#phonebook">Create new "Blocklist" phone book</a></li>
	<li><a data-tx="t0070:958ad5cf" href="#create-token">Generate CardDAV token</a> <span class="tag is-success" data-tx="t0058:3378b39d" th:if="${cardDavToken}">✓ Done</span></li>
	<li><a data-tx="t0071:9e1ea08e" href="#credentials">Enter login data in Fritz!Box</a></li>
	<li><a data-tx="t0059:4f985acc" href="#verify">Check installation</a></li>
	<li><a data-tx="t0060:91946e2c" href="#block">Activate call barring</a></li>
</ol>

<h2 data-tx="t0061:e8d5bb12" id="register">Step 1: Register with PhoneBlock</h2>

<p data-tx="t0062:fffc269" th:unless="${userName}">First you need to register or log in to PhoneBlock to start the setup.</p>

<div class="columns" th:unless="${userName}">
  <div class="column is-half is-offset-one-quarter">
	<a th:href="@{/login(location='/setup#register')}">
		<button class="button is-medium is-info is-fullwidth">
			<span class="icon">
				<i class="fa-solid fa-right-to-bracket"></i>
			</span>
			<span data-tx="t0063:1dc205">Log in</span>
		</button>
	</a>
  </div>
</div>
<p data-tx="t0064:c41dd734" th:if="${userName}"><span class="tag is-success is-large"><i class="fa-solid fa-check"></i></span> You are logged in as <code dir="ltr" th:text="${userName}"></code>, great! Continue to the next step.</p>
		
		<h2 data-tx="t0065:8bf85697" id="fritzbox">Step 2: Log in to FRITZ!Box</h2>

		<p data-tx="t0012:2354f60">For this to work, you must be connected to your WLAN at home or your computer must be connected directly to the FRITZ! The FRITZ!Box will first ask you for your password. If you have never logged in before, you will find this password on the bottom of the device.</p>

		<div class="columns">
		  <div class="column is-half is-offset-one-quarter">
			<a href="http://fritz.box" target="_blank">
				<button class="button is-medium is-primary is-fullwidth" data-tx="t0013:d44f7d1">Log in to FRITZ!Box</button>
			</a>
		  </div>
		</div>

		<h2 data-tx="t0066:502b2c97" id="phonebook">Step 3: Create new "Blocklist" phone book</h2>
		
		<p data-tx="t0015:60de307b">In order for your FRITZ!Box to block spam calls, it needs its own phone book in which all numbers of unwanted callers are entered. Call this phone book "Blocklist". For this</p>
		
		<ol>
			<li data-tx="t0016:ee677f2e">First navigate to the "Telephony" section,</li>
			<li data-tx="t0017:bf3c833">select the "Phone book" menu item and</li>
			<li data-tx="t0018:9545daeb">then click on the "New phone book" link.</li>
		</ol>
		
		<div class="columns">
		  <div class="column is-8 is-offset-2">
			<img alt="Fritz!Box call list" class="image" data-tx="t0037:b9f34dc9" th:src="@{/assets/img/setup/02-navigate-to-addressbooks.png}"/>
		  </div>
		</div>
		
		<h2 data-tx="t0072:356d507a" id="create-token">Step 4: Create CardDAV token</h2>

		<p data-tx="t0073:5843bc02">For the setup in your Fritz!Box you need a special CardDAV token as password. This token is only used for the connection between your Fritz!Box and PhoneBlock and can be revoked at any time in the settings.</p>

		<th:block th:if="${cardDavToken}">
			<p data-tx="t0074:f786328e"><span class="tag is-success is-large"><i class="fa-solid fa-check"></i></span> You have created a token! Continue to the next step.</p>
		</th:block>

		<th:block th:if="${userName} and ${!cardDavToken}">
			<p data-tx="t0075:ca529190">Now create a token for the Fritz! You can optionally add a comment so that you know later what the token is used for (e.g. "Fritz!Box living room").</p>

			<form method="post" th:action="@{/update-settings(action='createToken', location='/setup#create-token')}">
				<input name="token-type" type="hidden" value="CARDDAV"/>
				<div class="field has-addons">
					<div class="control is-expanded">
						<input class="input" data-tx="t0049:fe053998" name="token-label" placeholder="Optional: Comment (e.g. 'Fritz!Box living room')" type="text"/>
					</div>
					<div class="control">
						<button class="button is-primary" data-tx="t0050:21ce66dd" type="submit"><i class="fa-solid fa-key"></i> Create token</button>
					</div>
				</div>
			</form>
		</th:block>

		<p data-tx="t0051:9fe447a" th:unless="${userName}">You must first <a th:href="@{/login(location='/setup')}">log in</a> to create a token.</p>

		<h2 data-tx="t0076:35997409" id="credentials">Step 5: Enter login data in Fritz!Box</h2>

		<p data-tx="t0020:e4a227b8">Now you have to enter the login data in the FRITZ!</p>

		<ol>
			<li>
				<div data-tx="t0021:d5b1f48a">Enter the name <code dir="ltr">Blocklist</code> for the phone book that is to be used as a blocklist. You will need this name again for the next step.</div>
			</li>

			<li data-tx="t0022:32f6ec7">Select the option <i>Use phonebook of an online provider</i>.</li>

			<li data-tx="t0023:d59c1b48">Select the provider <i>CardDAV provider</i>.</li>

			<li>
				<div data-tx="t0079:c5926e14">Transfer the login data (preferably using Cut&amp;Paste to avoid typing errors).</div>

				<ul>
					<li data-tx="t0080:d646341e"><span><i>Internet address of the CardDAV server</i>:</span> <code dir="ltr" id="url2" th:text="|https://phoneblock.net${contextPath}/contacts/|"></code><a class="copyToClipboard" data-tx="t0042:3f7efe41" href="#" id="url2_" title="Copy to the clipboard."><i class="fa-solid fa-copy"></i></a> (URL of the PhoneBlock address book)</li>

					<li>
						<i data-tx="t0081:548c40c1">User name</i>: 
						
						<th:block data-tx="t0082:baafe4ec" th:if="${userName}"><code dir="ltr" id="login2" th:text="${userName}"></code><a class="copyToClipboard" data-tx="t0043:3f7efe41" href="#" id="login2_" title="Copy to the clipboard."><i class="fa-solid fa-copy"></i></a> (Your PhoneBlock user name)</th:block>

						<th:block data-tx="t0083:c9c6fa56" th:unless="${userName}">You must first log in (see <a href="#register">Step 1</a>).</th:block>
					</li>

					<li>
						<span>
							<i data-tx="t0084:e99dee32">password</i>:
						</span>
						
						<th:block data-tx="t0085:1d7c0447" th:if="${cardDavToken}"><code dir="ltr" id="passwd2" th:text="${cardDavToken.token}"></code><a class="copyToClipboard" data-tx="t0044:3f7efe41" href="#" id="passwd2_" title="Copy to the clipboard."><i class="fa-solid fa-copy"></i></a> (the token from step 4)</th:block>
						
						<th:block data-tx="t0078:c657e130" th:unless="${cardDavToken}">You must first create a token (see <a href="#create-token">step 4</a>).</th:block>
					</li>
				</ul>
			</li>
			
			<li>
				<p data-tx="t0086:95ea1a24"><b>Attention</b>: Select <b>none of your phones</b> under "Phone assignment"! Otherwise you will only find SPAM callers in the contacts on your phone.</p>
				<p data-tx="t0087:79f2e6a0">You can now confirm the creation of the new phone book.</p>
			</li>
		</ol>

		<div class="columns">
		  <div class="column is-8 is-offset-2">
			<img alt="Create new address book" class="image" data-tx="t0038:50de9d04" th:src="@{/assets/img/setup/03-add-address-book.png}"/>
		  </div>
		</div>

		<h2 data-tx="t0068:49ed5643" id="verify">Step 6: Check installation</h2>

		<p data-tx="t0027:6bd9c881">If everything went well, then your FRITZ!Box has loaded all the numbers from the PhoneBlock blocklist. You should now have a new "Blocklist" phonebook in the "Telephony / Phonebook" section. If you select the "Blocklist" tab, you can see all the numbers of current spam callers.</p>

		<div class="columns">
		  <div class="column is-8 is-offset-2">
			<img alt="Show retrieved blocklist" class="image" data-tx="t0039:3d7cbd9f" th:src="@{/assets/img/setup/04-check-blocklist.png}"/>
		  </div>
		</div>

		<h2 data-tx="t0069:16c40784" id="block">Step 7: Activate call barring</h2>
		
		<p data-tx="t0029:ffbbaf55">In the "Telephony / Call handling" section, you can now specify the new "Blocklist" phone book as the number range to be blocked.</p>			
		
		<p data-tx="t0030:2d9a1437">Scroll down to the sub-item "Block number ranges" and click the "Add range" button.</p>

		<div class="columns">
		  <div class="column is-8 is-offset-2">
			<img alt="Add new call barring" class="image" data-tx="t0040:e5649829" th:src="@{/assets/img/setup/05-add-blocklist.png}"/>
		  </div>
		</div>
		
		<p data-tx="t0031:56b8a409">In the new screen, select the option "Phone book" in the selection for "Area" and select the newly created phone book "Blocklist" as the "Phone book" to be blocked.</p>

		<div class="columns">
		  <div class="column is-8 is-offset-2">
			<img alt="Block callers with a phone number in the blocklist" class="image" data-tx="t0041:a8687137" th:src="@{/assets/img/setup/06-create-blocklist.png}"/>
		  </div>
		</div>
		
		<p data-tx="t0032:8943dc0d">Perfect! You've completed the setup. Your phone should now ring much less frequently because of an unwanted caller. And if it does, you can easily silence the troublemaker for yourself and the entire PhoneBlock community:</p>
		
		<div class="columns">
		  <div class="column is-half is-offset-one-quarter">
			<a th:href="@{/block}"><button class="button is-medium is-primary is-fullwidth" data-tx="t0033:fcebb7bf">Block phone number</button></a>
		  </div>
		</div>
	</div>
</section>

<div th:replace="~{fragments/page :: footer}"></div>
</body>
</html>